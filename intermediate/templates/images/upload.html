{% extends 'base.html' %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/upload.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}

{% block title %}{% endblock %}

{% block body %}
    <form class="container" action="view" method="post">
        <div class="wrapper">
            <div class="image">
                <img src="" alt="">
            </div>
            <div class="content">
                <div class="icon">
                    <i class="fa fa-image"></i>
                </div>
                <div class="text">No file chosen, yet!</div>
            </div>
            <div id="cancel-btn">
                <i class="fa fa-times"></i>
            </div>
            <div class="file-name">File name here</div>
        </div>
        <button type="button" onclick="defaultBtnActive()" id="custom-btn">Choose a file</button>
        <input id="default-btn" name="filename" type="file" hidden>
        <input id="image-data" name="image" type="text" hidden>
        <button type="submit" id="custom-btn">Upload <i class="fa fa-cloud-upload"></i></button>
    </form>
    <div class="redirect" hidden>{{ url_for('image_views.ViewImage') }}</div>
    <script>
        const wrapper = document.querySelector(".wrapper");
        const fileName = document.querySelector(".file-name");
        const defaultBtn = document.querySelector("#default-btn");
        const cancelBtn = document.querySelector("#cancel-btn i");
        const img = document.querySelector("img");
        const imgData = document.querySelector("#image-data");
        const redirect = document.querySelector(".redirect");
        let regExp = /[0-9a-zA-Z\^\&\'\@\{\}\[\]\,\$\=\!\-\#\(\)\.\%\+\~\_ ]+$/;
        function defaultBtnActive(){
            defaultBtn.click();
        }
        defaultBtn.addEventListener("change", function(){
            const file = this.files[0];
            if(file){
                const reader = new FileReader();
                reader.onload = function(){
                    const result = reader.result;
                    img.src = result;
                    imgData.value = img.src;
                    wrapper.classList.add("active");
                }
                cancelBtn.addEventListener("click", function(){
                    img.src = "";
                    imgData.value = "";
                    wrapper.classList.remove("active");
                })
                reader.readAsDataURL(file);
            }
            if(this.value){
                let valueStore = this.value.match(regExp);
                fileName.textContent = valueStore;
            }
        });
        function uploadBtnActivate(){
            if(fileName.textContent != "File name here"){
                let data = {'file': img.src, 'file_name': fileName.textContent}
                fetch("view", {
                    method: "POST", 
                    body: JSON.stringify(data)
                }).then(res => {
                    window.location = redirect.textContent;
                });
            }
            else{
                console.log("no file");
            }
        }
    </script>
{% endblock %}